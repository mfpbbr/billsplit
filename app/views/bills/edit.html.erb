<h2>Edit Bill</h2>
Bill id: <%= @bill.id %>
<br>
Added by: <%= link_to "#{@bill.user.username}", user_url(@bill.user) %>
<br>
Date added: <%= @bill.created_at %>
<br>
<br>
<form action="<%= bill_url(@bill) %>" method="post">
    <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
    
<label for="bill_total_amount">Total Amount: </label>
<input type="number" name="bill[total_amount]" value="<%= @bill.total_amount %>" id="bill_total_amount">
<br>
<label for="bill_description">Description: </label>
<input type="text" name="bill[description]" value="<%= @bill.description %>" id="bill_description">
<br>
<br>
<ul>
    
<% @bill.guests.each do |guest| %>
<li>
<%= guest.username %> paid $
<input type="hidden" name="bill[guests][][user_id]" value="<%= guest.user_id %>">
<input type="hidden" name="bill[guests][][username]" value="<%= guest.username %>">
<input type="text" name="bill[guests][][amount_paid]" value="<%= guest.amount_paid %>">. Should have paid $<input type="text" name="bill[guests][][amount_should_have_paid]" value="<%= guest.amount_should_have_paid %>">.

</li>
<% end %>
</ul>
<button type="submit" class="add-friend">Add Another Friend to Bill</button>
<br>
<br>

<input type="submit" value="Edit Bill">
<input name="_method" type="hidden" value="put">
</form>
<br>
<%= link_to "Back to Dashboard (do not edit bill)", root_url %>

<!-- Templates -->

<script type="text/text" id="listShow">
  <div class='friend-form'>
  <select name="bill[guests][][user_id]">
      <option value="">Friend Involved in Bill: </option>
      <% @user.friends.each do |friend| %>   
        <option value="<%= friend.id %>"><%= friend.username %></option>
      <% end %>
      
      <% @user.inverse_friends.each do |inverse_friend| %>   
        <option value="<%= inverse_friend.id %>"><%= inverse_friend.username %></option>
      <% end %>
  </select>
  <br>
  <input type="number" name="bill[guests][][amount_paid]" placeholder="Amount Paid">
  <input type="number" name="bill[guests][][amount_should_have_paid]" placeholder="Should Have Paid">
  <br>
  <br>
  </div>

</script>

<!-- JavaScript -->

<script type="text/javascript">
    $(document).ready(function() {
       $(".add-friend").click(function(event) {
          event.preventDefault();
          addFriend();
       });
    });

    var addFriend = function() {
        var templateFunction = _.template($("#listShow").html());
        var renderedContent = templateFunction();
        $(".add-friend").before(renderedContent);
    };
</script>